<app-componente-sin-conexion *ngIf="!online; else contenidoOnline"></app-componente-sin-conexion>
<!-- Si hay conexión, mostrar el contenido normal -->

<ng-template #contenidoOnline>
  <div class="form-container">
    <h1>Crear un producto nuevo</h1>
    <form [formGroup]="productoForm" (ngSubmit)="registrarProducto()" class="product-form">

      <!-- Nombre -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nombre del producto</mat-label>
        <input matInput formControlName="nombre" placeholder="Ej: Pollo asado">
        <mat-error *ngIf="productoForm.get('nombre')?.hasError('required')">
          El nombre es obligatorio
        </mat-error>
      </mat-form-field>

      <!-- Descripcion -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descripcion del producto</mat-label>
        <input matInput formControlName="descripcion" placeholder="Ej: Pollo asado">
        <mat-error *ngIf="productoForm.get('descripcion')?.hasError('required')">
          El Descripcion es obligatorio
        </mat-error>
      </mat-form-field>



      <!-- Categoría -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Categoría de productos</mat-label>
        <mat-select formControlName="categoria">
          <mat-option *ngIf="categoriasNuevas?.length === 0" [value]="'0'" disabled>
            SIN REGISTROS
          </mat-option>
          <mat-option *ngFor="let cat of categoriasNuevas" [value]="cat">
            {{ cat.nombreCategoria }}
          </mat-option>

        </mat-select>
        <mat-error *ngIf="productoForm.get('categoria')?.hasError('required')">
          La categoría es obligatoria
        </mat-error>
      </mat-form-field>


      <!-- Precio este input de precio lo voy a subir porque mas adelante puede que use el del precio-->
      <!--  <mat-form-field appearance="outline" class="full-width">
      <mat-label>Precio</mat-label>


       <input matInput autocomplete="off" #monto [value]="precio"
       name="precio" formControlName="precio" placeholder="$0.00"
        (change)="updateValue(monto.value)" (keypress)="validateFormat($event)" />

      <mat-error *ngIf="productoForm.get('precio')?.hasError('required')">
        El precio es obligatorio
      </mat-error>
      <mat-error *ngIf="productoForm.get('precio')?.hasError('min')">
        El precio debe ser mayor a 0
      </mat-error>
    </mat-form-field> -->

      <!-- Selección de imágenes -->
      <div class="upload-container">
        <button class="btn btn-primary" type="button" (click)="fileInput.click()">Seleccionar imágenes</button>
        <input type="file" #fileInput (change)="onFileSelected($event)" multiple accept="image/*" hidden />

        <!-- Previsualización -->
        <div class="preview-container" *ngIf="selectedImages.length > 0">
          <div class="preview" *ngFor="let img of selectedImages; let i = index">
            <img [src]="img" alt="Previsualización" />
            <!-- Botón de eliminar -->
            <button type="button" class="delete-btn" (click)="removeImage(i)">
              <i class="bi bi-trash3-fill"></i>
            </button>
          </div>
        </div>

        <mat-error *ngIf="productoForm.get('imagenes')?.hasError('required') && productoForm.get('imagenes')?.touched">
          Debes seleccionar al menos una imagen
        </mat-error>
      </div>

      <!-- Botón -->
      <button class="btn btn-primary" type="submit" [disabled]="productoForm.invalid || isLoading">
        <ng-container *ngIf="!isLoading; else loading">
          Registrar Producto
        </ng-container>

        <ng-template #loading>
          <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
          <span class="ms-2" role="status">Registrando...</span>
        </ng-template>
      </button>

    </form>
  </div>
</ng-template>
